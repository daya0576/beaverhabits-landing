---
import PricingCard from './PricingCard';

const priceId = import.meta.env.PADDLE_PRICE_ID;

// Debug: Check if env var is loaded during build
if (!priceId) {
  console.warn('⚠️ PADDLE_PRICE_ID is not set - Pro upgrade button may not work');
}
---

<section id="pricing" class="py-36 px-4 bg-[rgb(var(--color-surface))]">
  <div class="container mx-auto max-w-6xl">
    <div class="text-center mb-12">
      <h2 class="text-4xl md:text-5xl font-bold mb-4">Simple, transparent pricing</h2>
      <p class="text-xl text-gray-400">Start free, upgrade when you're ready</p>
    </div>
    <div class="grid md:grid-cols-2 gap-8">
      <PricingCard
        client:load
        title="Basic"
        price="$0"
        description="Key features"
        features={[
          'Add notes/descriptions',
          'Export & Import',
          'RESTful API',
          'Community support'
        ]}
        buttonText="GET STARTED"
        buttonLink="https://beaverhabits.com/gui"
      />
      
      <div class="relative">
        <div id="user-info" class="absolute -top-3 right-4 z-10"></div>
        <PricingCard
          client:load
          title="Pro"
          price="$9.90"
          description="Buy lifetime license"
          features={[
            'Unlimited habits',
            'Organize habits by category',
            'Daily backup',
            '14-day policy return'
          ]}
          buttonText="UPGRADE"
          priceId={priceId}
          isPro={true}
        />
      </div>
    </div>
  </div>
</section>

<script>
  function getCookie(name: string): string | null {
    const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
    return match ? decodeURIComponent(match[2]) : null;
  }

  const email = getCookie('email');
  const isPro = getCookie('is_pro') === 'true';
  
  if (email) {
    const userInfoDiv = document.getElementById('user-info');
    if (userInfoDiv) {
      const badge = isPro 
        ? '<span class="ml-1.5 px-1.5 py-0.5 text-[9px] font-bold bg-green-500/20 text-green-400 border border-green-500/40 rounded">✓ ACTIVE</span>'
        : '';
      
      userInfoDiv.innerHTML = `
        <div class="flex items-center gap-1.5 px-2.5 py-1 bg-gray-900/90 border border-gray-700/60 rounded-md text-[11px] shadow-lg backdrop-blur-sm">
          <span class="text-gray-400">${email}</span>${badge}
        </div>
      `;
    }
  }
</script>